<mapper namespace="posts">
	<!-- 레시피 등록 -->
    <insert id="insertPost" parameterType="com.recipetime.find.Model.Post" useGeneratedKeys="true" keyProperty="recipeid">
        INSERT INTO recipepost
        (recipetitle, recipecontent, recipewritedate, recipefixdate,
         recipemainvidlink, ishotdisplay, isbestdisplay, isprivate,
         recipedeactivate, isreport, userid, maincategoryid, subcategoryid, subcategoryname)
        VALUES
        (#{recipetitle}, #{recipecontent}, NOW(), NOW(),
         #{recipemainvidlink}, #{ishotdisplay}, #{isbestdisplay}, #{isprivate},
         #{recipedeactivate}, #{isreport}, #{userid}, #{maincategoryid}, #{subcategoryid}, #{subcategoryname})
    </insert>

    <!-- 태그 등록 -->
    <insert id="insertTag">
        INSERT INTO recipetag (recipeid, tagorder, tagname)
        VALUES (#{recipeid}, #{tagorder}, #{tagname})
    </insert>

    <!-- 첨부파일 등록 -->
    <insert id="insertAttachment">
        INSERT INTO attachment (fileorder, filename, fileuuid, fileext, type, isMain, recipeid, recipestepid)
        VALUES (#{fileorder}, #{filename}, #{fileuuid}, #{fileext}, #{type}, #{isMain}, #{recipeid}, #{recipestepid})
    </insert>

    <!-- 레시피 단계 등록 -->
    <insert id="insertSequence" useGeneratedKeys="true" keyProperty="recipestepid">
        INSERT INTO recipesequence (recipeid, recipestep, explain, recipevidlink, 
                                    ingactivate, toolactivate, fireactivate, tipactivate,
                                    ingexp, toolexp, fireexp, tipexp)
        VALUES (#{recipeid}, #{recipestep}, #{explain}, #{recipevidlink}, 
                #{ingactivate}, #{toolactivate}, #{fireactivate}, #{tipactivate},
                #{ingexp}, #{toolexp}, #{fireexp}, #{tipexp})
    </insert>
    
     <!-- 게시글 조회 (일반 유저용) -->
    <select id="getPostForUser" parameterType="map" resultType="com.recipetime.find.Model.Post">
        SELECT *
        FROM recipepost
        WHERE recipeid = #{recipeid}
          AND recipedeactivate = 0
          AND (isprivate = 1 OR userid = #{loginUserId})
    </select>

    <!-- 게시글 조회 (관리자용) -->
    <select id="getPostForAdmin" parameterType="int" resultType="com.recipetime.find.Model.Post">
        SELECT *
        FROM recipepost
        WHERE recipeid = #{recipeid}
    </select>

    <!-- 게시글 등록 -->
    <insert id="insertPost" parameterType="com.recipetime.find.Model.Post" useGeneratedKeys="true" keyProperty="recipeid">
        INSERT INTO recipepost
        (recipetitle, recipecontent, recipewritedate, recipefixdate,
         recipemainvidlink, ishotdisplay, isbestdisplay, isprivate,
         recipedeactivate, isreport, userid, maincategoryid, subcategoryid, subcategoryname)
        VALUES
        (#{recipetitle}, #{recipecontent}, NOW(), NOW(),
         #{recipemainvidlink}, #{ishotdisplay}, #{isbestdisplay}, #{isprivate},
         #{recipedeactivate}, #{isreport}, #{userid}, #{maincategoryid}, #{subcategoryid}, #{subcategoryname})
    </insert>
</mapper>